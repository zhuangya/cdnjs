/*!{id:msgpack.js,ver:1.05,license:"MIT",author:"uupaa.js@gmail.com"}*/// === msgpack ===
// MessagePack -> http://msgpack.sourceforge.net/
this.msgpack||function(a){function l(a,b){h=0;var c=n([],a,0);return h?!1:b?p(c):c}function m(a){return f=typeof a=="string"?t(a):a,g=-1,o()}function n(a,b,c){var d,e,f,g,j,l,m,o,p,q;if(b==null)a.push(192);else if(b===!1)a.push(194);else if(b===!0)a.push(195);else switch(typeof b){case"number":b!==b?a.push(203,255,255,255,255,255,255,255,255):b===Infinity?a.push(203,127,240,0,0,0,0,0,0):Math.floor(b)===b?b<0?b>=-32?a.push(224+b+32):b>-128?a.push(208,b+256):b>-32768?(b+=65536,a.push(209,b>>8,b&255)):b>-2147483648?(b+=4294967296,a.push(210,b>>>24,b>>16&255,b>>8&255,b&255)):(l=Math.floor(b/4294967296),m=b&4294967295,a.push(211,l>>24&255,l>>16&255,l>>8&255,l&255,m>>24&255,m>>16&255,m>>8&255,m&255)):b<128?a.push(b):b<256?a.push(204,b):b<65536?a.push(205,b>>8,b&255):b<4294967296?a.push(206,b>>>24,b>>16&255,b>>8&255,b&255):(l=Math.floor(b/4294967296),m=b&4294967295,a.push(207,l>>24&255,l>>16&255,l>>8&255,l&255,m>>24&255,m>>16&255,m>>8&255,m&255)):(o=b<0,o&&(b*=-1),p=Math.log(b)/.6931471805599453+1023|0,q=b*Math.pow(2,1075-p),m=q&4294967295,o&&(p|=2048),l=q/4294967296&1048575|p<<20,a.push(203,l>>24&255,l>>16&255,l>>8&255,l&255,m>>24&255,m>>16&255,m>>8&255,m&255));break;case"string":f=b.length,j=a.length,a.push(0);for(e=0;e<f;++e)g=b.charCodeAt(e),g<128?a.push(g&127):g<2048?a.push(g>>>6&31|192,g&63|128):g<65536&&a.push(g>>>12&15|224,g>>>6&63|128,g&63|128);d=a.length-j-1,d<32?a[j]=160+d:d<65536?a.splice(j,1,218,d>>8,d&255):d<4294967296&&a.splice(j,1,219,d>>>24,d>>16&255,d>>8&255,d&255);break;default:if(++c>=k)return h=1,a=[];if(i(b)){d=b.length,d<16?a.push(144+d):d<65536?a.push(220,d>>8,d&255):d<4294967296&&a.push(221,d>>>24,d>>16&255,d>>8&255,d&255);for(e=0;e<d;++e)n(a,b[e],c)}else{j=a.length,a.push(0),d=0;for(e in b)++d,n(a,e,c),n(a,b[e],c);d<16?a[j]=128+d:d<65536?a.splice(j,1,222,d>>8,d&255):d<4294967296&&a.splice(j,1,223,d>>>24,d>>16&255,d>>8&255,d&255)}}return a}function o(){var a,b,c,d,e=0,h,i,k,l,m,n=f,q=n[++g];if(q>=224)return q-256;if(q<192){if(q<128)return q;q<144?(e=q-128,q=128):q<160?(e=q-144,q=144):(e=q-160,q=160)}switch(q){case 192:return null;case 194:return!1;case 195:return!0;case 202:e=n[++g]*16777216+(n[++g]<<16)+(n[++g]<<8)+n[++g],h=e&2147483648,i=e>>23&255,k=e&8388607;if(!e||e===2147483648)return 0;if(i===255)return k?NaN:Infinity;return(h?-1:1)*(k|8388608)*Math.pow(2,i-127-23);case 203:e=n[++g]*16777216+(n[++g]<<16)+(n[++g]<<8)+n[++g],h=e&2147483648,i=e>>20&2047,k=e&1048575;if(!e||e===2147483648)return g+=4,0;if(i===2047)return g+=4,k?NaN:Infinity;return e=n[++g]*16777216+(n[++g]<<16)+(n[++g]<<8)+n[++g],(h?-1:1)*((k|1048576)*Math.pow(2,i-1023-20)+e*Math.pow(2,i-1023-52));case 207:return e=n[++g]*16777216+(n[++g]<<16)+(n[++g]<<8)+n[++g],e*4294967296+n[++g]*16777216+(n[++g]<<16)+(n[++g]<<8)+n[++g];case 206:e+=n[++g]*16777216+(n[++g]<<16);case 205:e+=n[++g]<<8;case 204:return e+n[++g];case 211:e=n[++g];if(e&128)return((e^255)*72057594037927940+(n[++g]^255)*281474976710656+(n[++g]^255)*1099511627776+(n[++g]^255)*4294967296+(n[++g]^255)*16777216+(n[++g]^255)*65536+(n[++g]^255)*256+(n[++g]^255)+1)*-1;return e*72057594037927940+n[++g]*281474976710656+n[++g]*1099511627776+n[++g]*4294967296+n[++g]*16777216+n[++g]*65536+n[++g]*256+n[++g];case 210:return e=n[++g]*16777216+(n[++g]<<16)+(n[++g]<<8)+n[++g],e<2147483648?e:e-4294967296;case 209:return e=(n[++g]<<8)+n[++g],e<32768?e:e-65536;case 208:return e=n[++g],e<128?e:e-256;case 219:e+=n[++g]*16777216+(n[++g]<<16);case 218:e+=(n[++g]<<8)+n[++g];case 160:for(l=[],b=g,c=b+e;b<c;)d=n[++b],l.push(d<128?d:d<224?(d&31)<<6|n[++b]&63:(d&15)<<12|(n[++b]&63)<<6|n[++b]&63);return g=b,l.length<10240?j.apply(null,l):p(l);case 223:e+=n[++g]*16777216+(n[++g]<<16);case 222:e+=(n[++g]<<8)+n[++g];case 128:m={};while(e--){a=n[++g]-160;for(l=[],b=g,c=b+a;b<c;)d=n[++b],l.push(d<128?d:d<224?(d&31)<<6|n[++b]&63:(d&15)<<12|(n[++b]&63)<<6|n[++b]&63);g=b,m[j.apply(null,l)]=o()}return m;case 221:e+=n[++g]*16777216+(n[++g]<<16);case 220:e+=(n[++g]<<8)+n[++g];case 144:l=[];while(e--)l.push(o());return l}return}function p(a){try{return j.apply(this,a)}catch(b){}var c=[],e=0,f=a.length,g=d;for(;e<f;++e)c[e]=g[a[e]];return c.join("")}function q(a,b,c){b.method="GET",b.binary=!0,s(a,b,c)}function r(b,c,d){c.method="PUT",c.binary=!0;if(c.worker&&a.Worker){var e=new Worker(msgpack.worker);e.onmessage=function(a){c.data=a.data,s(b,c,d)},e.postMessage({method:"pack",data:c.data})}else c.data=v(l(c.data)),s(b,c,d)}function s(c,d,e){function f(){if(p.readyState===4){var c,f=p.status,g,i,k={status:f,ok:f>=200&&f<300};if(!(q++)){if(j==="PUT")c=k.ok?p.responseText:"";else if(k.ok){if(d.worker&&a.Worker){g=new Worker(msgpack.worker),g.onmessage=function(a){e(a.data,d,k)},g.postMessage({method:"unpack",data:p.responseText}),h();return}i=b?u(p):t(p.responseText),c=m(i)}n&&n(p,d,k),e(c,d,k),h()}}}function g(a,b){if(!(q++)){var c={status:b||400,ok:!1};n&&n(p,d,c),e(null,d,c),h(a)}}function h(b){b&&p&&p.abort&&p.abort(),i&&(clearTimeout(i),i=0),p=null,a.addEventListener&&a.removeEventListener("beforeunload",g,!1)}var i=0,j=d.method||"GET",k=d.header||{},l=d.before,n=d.after,o=d.data||null,p=a.XMLHttpRequest?new XMLHttpRequest:a.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,q=0,r,s="overrideMimeType",v="setRequestHeader",w=j==="GET"&&d.binary;try{p.onreadystatechange=f,p.open(j,c,!0),l&&l(p,d),w&&p[s]&&p[s]("text/plain; charset=x-user-defined"),o&&p[v]("Content-Type","application/x-www-form-urlencoded");for(r in k)p[v](r,k[r]);a.addEventListener&&a.addEventListener("beforeunload",g,!1),p.send(o),i=setTimeout(function(){g(1,408)},(d.timeout||10)*1e3)}catch(x){g(0,400)}}function t(a){var b=[],d=c,e,f=a.split(""),g=-1,h;h=f.length,e=h%8;while(e--)++g,b[g]=d[f[g]];e=h>>3;while(e--)b.push(d[f[++g]],d[f[++g]],d[f[++g]],d[f[++g]],d[f[++g]],d[f[++g]],d[f[++g]],d[f[++g]]);return b}function u(a){var b=[],c,d,e="charCodeAt",f,g,h,i,j,k,l,m,n,o=-1,p;p=vblen(a),c=vbstr(a),f=Math.ceil(p/2),d=f%8;while(d--)g=c[e](++o),b.push(g&255,g>>8);d=f>>3;while(d--)g=c[e](++o),h=c[e](++o),i=c[e](++o),j=c[e](++o),k=c[e](++o),l=c[e](++o),m=c[e](++o),n=c[e](++o),b.push(g&255,g>>8,h&255,h>>8,i&255,i>>8,j&255,j>>8,k&255,k>>8,l&255,l>>8,m&255,m>>8,n&255,n>>8);return p%2&&b.pop(),b}function v(b){var c=[],f=0,g=-1,h=b.length,i=[0,2,1][b.length%3],j=d,k=e;if(a.btoa){while(g<h)c.push(j[b[++g]]);return btoa(c.join(""))}--h;while(g<h)f=b[++g]<<16|b[++g]<<8|b[++g],c.push(k[f>>18&63],k[f>>12&63],k[f>>6&63],k[f&63]);return i>1&&(c[c.length-2]="="),i>0&&(c[c.length-1]="="),c.join("")}a.msgpack={pack:l,unpack:m,worker:"msgpack.js",upload:r,download:q};var b=/MSIE/.test(navigator.userAgent),c={},d={},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),f=[],g=0,h=0,i=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},j=String.fromCharCode,k=512;self.importScripts&&(onmessage=function(a){a.data.method==="pack"?postMessage(v(l(a.data.data))):postMessage(m(a.data.data))}),function(){var a=0,b;for(;a<256;++a)b=j(a),c[b]=a,d[a]=b;for(a=128;a<256;++a)c[j(63232+a)]=a}(),b&&document.write('<script type="text/vbscript">Function vblen(b)vblen=LenB(b.responseBody)End Function\nFunction vbstr(b)vbstr=CStr(b.responseBody)+chr(0)End Function</script>')}(this);